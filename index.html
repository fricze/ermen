<!DOCTYPE html>
<html>
</head>
    <title>My First Web Page</title>
</head>

<body>
    <div>
        <p>Select local CSV File:</p>
        <input id="csv" type="file" accept=".csv">
    </div>

    <table id="data_table">
        <thead>
            <tr>
                <th>UPC_Code</th>
                <th>Product_Name</th>
            </tr>
        </thead>
        <tbody id="data_table_body">
            <!-- existing data could optionally be included here -->
        </tbody>
    </table>

    <template id="data_header">
        <th></th>
    </template>

    <template id="data_cell">
        <td></td>
    </template>

    <template id="data_row">
        <tr>
        </tr>
    </template>
</body>

<script type="text/javascript" src="https://unpkg.com/d3@7.6.1/dist/d3.min.js"></script>

<script>
    const fileInput = document.getElementById('csv')
    const outElement = document.getElementById('out')
    const previewCSVData = async dataurl => {
        const dataset = await d3.csv(dataurl)

        const rows = dataset.slice(0, 100).map((col) => {
            const row = window.data_row.content.cloneNode(true)
            const values = Object.values(col)
            row.querySelector("tr").replaceChildren(...values.map((cell) => {
                const cellElement = window.data_cell.content.cloneNode(true)
                cellElement.querySelector("td").textContent = cell
                return cellElement
            }))

            return row
        })
        document.querySelector('tbody').replaceChildren(...rows)

        const columns = dataset.columns.map((col) => {
            const header = window.data_header.content.cloneNode(true)
            header.querySelector("th").textContent = col
            return header
        })
        document.querySelector('thead tr').replaceChildren(...columns)
    }

    const readFile = e => {
        const file = fileInput.files[0]
        const reader = new FileReader()
        reader.onload = () => {
            const dataUrl = reader.result;
            previewCSVData(dataUrl)
        }
        reader.readAsDataURL(file)
    }

    fileInput.onchange = readFile
</script>

</html>
